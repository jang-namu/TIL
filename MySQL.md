# MySQL

* 책: SQL 첫걸음 - 아사이 아츠시

* DB와 DBMS
    * 과거에는 파일 시스템 사용 => 데이터 중복 => 일관성, 무결성 등 문제가 된다.
    * 공통된 데이터를 공유해서 쓰자! => DB와 DB를 관리하는 시스템인 DBMS의 등장
    * DBMS가 왜 필요한가?
        1. 기존에는 시스템 구축 시 기본 기능부터 구현해야 했다. DBMS는 데이터 검색, 추가, 삭제, 갱신 등의 기본 기능을 제공한다.
        2. 대용량 데이터 저장 및 고속 검색, 복수 유저 요청 대응 등 다양한 기능 제공
        3. 신뢰성 보장. 백업기능, 소프트웨어를 통한 확장성(Scalability)과 부하 분산(Load balancing). (클러스터 구성 또는 스케일 아웃이라고도 함)
    * RDBMS는 클라이언트/서버 모델로 구성된다. 클라이언트는 DB서버에 접속해 SQL 명령으로 DB를 조작할 수 있다.

* SQL (Structured Query Language)
    * RDBMS(관계형 DBMS)를 다루기 위한 언어
    * SQL의 종류
        1. DML(Data Manipulation Language) : 데이터베이스에 CRUD 등 데이터를 조작하는데 사용.
        2. DDL(Data Definition Lang.) : DB 객체(테이블)를 만들거나 삭제하는 등의 명령.
        3. DCL(Data Control Lang.) : 트랜잭션 제어, 접근 권한 제어 등의 명령을 포함.

* DB의 종류
    * 계층형(파일)
    * 관계형(RDB)
    * 객체지향 DB : 객체지향 언어의 객체를 가능하면 그대로 저장
    * XML DB : XML의 형태로 태그를 잉용해 마크업 문서로 작성.
    * KVS(키-밸류 스토어) : NoSQL의 등장과 함께 나옴, 열 지향 데이터베이스라고도 한다.

* 루프 백 접속 : PC 한 대로 클라이언트와 서버 모두 실행할 때, 클라이언트에서 서버에 접속하기 위해 네트워크를 경유해서 PC 서버로 되돌아오는 형태의 접속.

* 웹 시스템과 동적 웹의 전체적인 그림을 그려보자.
    1. 클라이언트(브라우저)는 웹 서버에 요청(request)한다.
    2. 웹 서버는 클라이언트의 요청에 대한 결과를 만들기 위해, 웹 서버의 CGI(Common Gateway Interface)를 동작시킨다.
    3. CGI는 프로그램이 DB에 클라이언트로서 접속하여 SQL 명령을 전달한다.
    4. DB 서버는 명령에 대한 결과를 돌려주고, 이를 웹서버가 받아 동적 콘텐츠를 생성한다.
    5. 생성한 콘텐츠로 클라이언트(브라우저)에게 응답(response)한다.



* MySQL 클라이언트
    * MySQL 서버에 접속해 SQL 명령을 수행하기 위한 소프트웨어
    * use [database]의 'use'와 show databases 명령의 'show' 등은 SQL명령이 아닌 MySQL 클라이언트 프로그램의 고유명령이다!

## DB
* DB에는 테이블 외에 다양한 데이터를 저장하거나 관리하는 여러 종류의 '데이터베이스 객체'를 만들 수 있다. (ex) 뷰(view))
* DB 객체는 이름을 붙여 관리하고, 같은 이름으로 다른 DB 객체를 만들 수는 없다.
* DESC [Table] : 테이블 '구조'를 참조한다.
    * 테이블의 열 정보(Field, Type, NULL 제약사항 등)을 확인 가능하다.
        * Field : 열 이름
        * Type : 해당 열의 자료형. INTEGER, CHAR, VARCHAR, DATE, TIME
            * ex) int(11) : 11자리의 정수값을 저장할 수 있는 자료형
            * CHAR는 크기 고정. 빈 공간을 공백문자로 채우고, VARCHAR는 필요한 공간만큼만 사용. 저장공간을 가변적으로 사용한다.
            * CHAR를 고정 길이 문자열, VARCHAR를 가변 길이 문자열이라고 한다.
            * DATE는 날짜-연월일 TIME은 시간-시분초
        * NULL : NULL 값을 허용할 것인지를 나타내는 제약사항. YES/NO
        * Key : 해당 열이 '키'로 지정되어 있는지
        * Default : 해당 열에 주어진 '기본값' 즉, 입력을 생략했을 때 주어지는 값



## SQL
* SQL의 '구'에는 순서가 정해져 있다. ex) 'SELECT 열 FROM 테이블명 WHERE 조건식'은 가능 => 'SELECT .. WHERE .. FROM ..' 등은 불가
* SELECT : 데이터베이스의 데이터를 읽어오는(**참조하는**) DML 명령
    * SELECT는 '질의' 또는 '쿼리'로 불리기도 한다.
    * ex) SELECT * FROM [Table];        ('*'은 '모든 열'을 의미하는 메타문자)
    * 수치형은 오른쪽 정렬, 문자열, 날짜, 시간형은 왼쪽 정렬된다.

    * SELECT 구 : 열을 선택할 때 사용.
        * ex) SELECT no, name FROM sampletable; : sampletable 테이블에서 no, name 열을 가져온다.
        * 열을 지정하는 순서는 임의대로 정할 수 있다. SQL 명령의 결과는 지정한 순서대로 나온다.
            * 동일한 열을 중복으로 가져올 수도 있다..
    * WHERE 구 : 'WHERE [조건식]' 형태로, 행을 선택할 때 사용.
        * ex) SELECT * FROM sample21 WHERE no = 2; : no 열이 2인 행만 가져온다.
    * ORDER BY 구 : 행을 정렬해서 결과를 가져올 때 사용.
        * 'WHERE'이 존재하면 그 뒤에, 존재하지 않으면 'FROM' 뒤에 작성한다.
        * 'ORDER BY 열' 형식으로 사용하며, 열 뒤에 DESC(descendant, 하강)를 붙이면 내림차순으로 정렬, 
        * 기본값을 오름차순으로 정렬되며, 열 뒤에 ASC(ascendant, 상승)를 붙여도 된다.
        * 수치형, 날짜, 시간형은 숫자의 대소관계로 정렬되지만, **문자열형의 경우 사전순서로 정렬**된다.
            * 따라서 문자열형 도메인 셀에 숫자를 저장한다면, 정렬 시 주의해야 한다.
        * 마찬가지로 'OREDER BY 열 [ASC/DESC], 열 [ASC/DESC]...' 형태로 여러 정렬 기준으로 참조할 수 있다.
        * MySQL에서 ASC는 기본값이기 때문에, 안 써도 되지만 DB에 따라 기본값이 다를 수 있다.
        * **가독성을 위해 ASC도, DESC도(당연히) 지정하자.**

        * **NULL 값의 정렬 순서**
            * NULL 값은 표준 SQL에도 정의되어 있지 않아, DB 제품따라 기준이 다르다.
            * **MySQL에서는 NULL 값을 가장 작은 값으로 본다.** (ASC에서 가장 먼저 나옴)
    * LIMIT [OFFSET] 구 : 결과 행을 제한하는데 사용.
        * 커뮤니티 게시판에 페이지가 1, 2, 3... 으로 나뉘는 것 처럼, 결과값을 제한해서 반환하는데 사용한다.
        * 'LIMIT 행수 [OFFSET 시작행]' 형식으로 사용. SELECT 명령의 **마지막에 지정한다.**
        * LIMIT 뒤 '행수'만큼의 행을 결과로 가져오고, 'OFFSET'은 'LIMIT'만큼의 행을 가져올 시작위치를 지정한다.
        * 'OFFSET' 뒤 '시작행' + 1 위치부터 가져온다. 즉, '시작행'까지를 OFF로 만들고 그 다음행부터 가져온다.
        * 이는 내부적으로 WHERE 구로 검색한 후 ORDER BY로 정렬된 뒤 최종적으로 처리된다.

    * 수치 연산
        * SQL은 DB 조작어이기도 하지만, 컴퓨터를 조작하는 언어이기 때문에 계산기능을 포함한다.
        * 즉, + - * / % 등 기본 연산과 SQRT, ROUND, TRUNCATE, SIN, COS, LOG, MOD 등의 함수를 이용해 연산이 가능하다.
        * ROUND, TRUNCATE 등은 두번째 인수에 소수점 몇번째 자리에서 반올림/버림 할 것인지 지정할 수 있다.
            * 0은 소수점 첫번째, 1은 두번째, -2는 정수부 10의 단위를 의미한다.

        * SELECT 구에서 연산
            * SELECT 구는 열명을 지정한다. 그런데 열명 대신 식을 기술할수도 있다.
            * SELECT *, price*quantity FROM sample; : 이는 sample 테이블의 모든 행과 열 + price와 quantity를 곱해 만든 새로운 열을 반환한다.
        * WHERE 구에서 연산
            * WHERE 구의 조건식에도 연산을 적용할 수 있다.
            * SELECT  *, price*quantity AS amount FROM sample WHERE price*quantity >= 2000;
                * price * quantity가 2000 이상인 행만을 가져온다.
            * **WHERE 구에서는 SELECT 구에서 지정한 별명(alias)를 사용하지 못 한다!!**
                * DB 서버에서 내부적으로 WHERE 구 -> SELECT 구 순서로 처리된다.
                * 많은 DB가 행선택(WHERE) 이후 열선택(SELECT)의 순서로 내부처리를 한다.
                * 별명은 SELECT 구문을 처리할 때 붙여지므로, WHERE 구애서는 별칭을 아직 알지 못 한다!
        * ORDER BY 구에서 연산
            * ORDER BY 구에서 연산을 통해 결과값들을 정렬할 수 있다.
            * 예를 들어 가격 X 수량의 연산 결과 값으로 오름차순 정렬할 수 있다.
            * SELECT *, price*quantity AS amount FROM sample ORDER BY price*quantity;
            * **ORDER BY 구에서는 SELECT에서 지정한 별칭을 사용할 수 있다.**
                * DB서버에서 **내부적으로 WHERE -> SELECT -> ORDER BY 순으로 처리된다.**

        * 열의 별명(alias)
            * 위와같이 식을 통해 새로운 열을 만들 때, 열 이름이 길고 어려운 경우에 별명을 붙여 열 이름을 재지정할 수 있다.
            * SELECT *, price * quantity AS amount FROM sample; : 'AS 별명' 형식으로 새로운 열 뒤에 별명을 붙인다.
            * AS는 생략 가능하나 하지않는 것이 좋다.
            * 별명은 영어, 숫자, 한글로 지정할 수 있는데, 한글로 지정하는 경우 여러 이유로 오작동하는 경우가 많다.
            * 그래서 한글로 지정하는 경우에는 SQL 표준은 더블쿼트(""), MySQL에서는 백쿼트(``)로 감싸 지정한다.
                * ex) SELECT price*quantity AS `금액` FROM sample34;
                * 이는 DB 객체 이름에 ASCII문자 이외의 것을 사용할 경우에 해당한다.
                * 마찬가지로 백쿼트(MySQL)로 감싸면, 예약어도 별명으로 사용이 가능하다.
                    * ANSI_QUOTES SQL 모드가 활성화 된 상태에선, 더블 쿼트를 사용할 수 있다.
                        * 이는 강제로 ANSI SQL 표준을 따르게 한다. 다만, **일반적으로 MySQL은 백쿼트의 사용을 권장한다.**
                * 여러 프로그래밍 언어에서와 마찬가지로 객체 이름은 숫자로 시작할 수 없다.
        * 더블쿼트(""), 싱글쿼트('')
            * 더블 쿼트로 둘러싸면 명령구문을 분석할 때 데이터베이스 객체의 이름이라고 간주한다.
                * MySQL에서는 백쿼트(``)로 사용하기도 한다.
            * 싱글 쿼트로 둘렀는 것은 문자열 상수를 의미한다.



## 연산자
* 조건식에서 문자열형, 날짜형, 시간형 등은 '' 싱클 쿼트로 둘러싸 표기해야한다. 
    * 그 외에 날짜형의 연월일은 '-' 하이픈으로, 시간형의 시분초는 ':' 콜론으로 구분하여 표기한다.
    * 수치형은 그대로 표기한다.
* 비교 연산자
    * 'IS NULL' : NULL 값을 검색할 때 사용한다. NULL 값은 '=' 연산자로 검색할 수 없다.
        * NULL 값이 '아닌' 값을 검색하고 싶을 때는 'IS NOT NULL'을 사용한다.
        * ex) SELECT * FROM sample WHERE name IS NULL;
    * '<>' : 값이 서로 다른 경우 '참', 같으면 '거짓'. 즉, '='의 역이다.
* NULL 값의 연산
    * 몇몇 프로그래밍 언어(C, PHP)에서는 NULL을 0으로도 처리한다. 
    * **SQL에서는 NULL로 연산한 결과는 NULL이 된다!**
* 논리 연산자
    * AND
    * OR
        * **AND와 OR에 비해 우선순위가 높다.**
        * 즉, 'a=1 OR a=2 AND b=1 OR b=2' 는 'a=1 OR (a=2 AND b=1) OR b=2'와 같아진다.
        * 따라서 AND와 OR을 같이 쓸 때에는, 생각한 우선순위에 맞춰 적절하게 괄호로 묶어준다.
    * NOT
        * 'NOT 조건식' 형태로 사용. 조건식에 반대되는 값을 반환.

* **패턴 매칭**
    * 메타문자 (와일드카드)
    * 패턴 매칭 시, 임의의 문자 또는 문자열에 매치하는 부분을 지정하기 위해 쓰이는 특수 문자.
        * '%' : 임의의 '문자열'을 의미. 빈 문자열과도 매치된다!
            * 'SQL'이 포함된 문자열을 검색할 때,
                1. 'SQL%' : 전방 일치, SQL로 시작하는 문자열, 즉, 지정한 문자(SQL) 뒤로 임의의 문자열 존재.
                2. '%SQL%' : 중간 일치, 지정한 문자 앞뒤로 임의의 문자열 존재.
                3. '%SQL' : 후방 일치, 앞쪽에 임의의 문자열 존재.
        * '_' : 임의의 '문자' 하나를 의미
            * '*'도  또한 자주 쓰이는 와일드카드이지만, LIKE에서는 사용할 수 없다.
        * 메타문자를 검색하고 싶을 경우.
            * 이스케이프 : '\'를 앞에 붙인다. ex) text LIKE '%\%%'
        * ' 싱글 쿼트를 검색하고 싶은 경우.
            * '를 두개 연속으로 써서 '' 같은 형식으로 사용. ex) It's => 'It''s'
    * LIKE (술어): **패턴 매칭, 문자열의 일부분을 비교**
        * '열 LIKE 패턴' 형식으로 사용한다. 
        * 패턴은 매칭 대상을 지정한다. 수치형 상수는 지정할 수 없으며, 문자열로 지정한다.
        * '=' 연산자는 내용이 완전히 동일한지, LIKE는 특정 문자나 문자열이 포함되어 있는지를 본다.
    